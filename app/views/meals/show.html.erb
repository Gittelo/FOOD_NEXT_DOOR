<div class="meal-banner" style="background-image: url('https://images.unsplash.com/photo-1473093226795-af9932fe5856?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=3bf6fd384a4045ad91b8f08279f02ab8&auto=format&fit=crop&w=685&q=80');">
</div>


<div class="main-container">

  <div class="left-section">
    <div class="meal-header">
      <h4>
        <%= @meal.name %>
        <% if current_user == @meal.cook %>
          <%= link_to edit_meal_path do %>
            <i class="fas fa-pencil-alt fa-l"></i>
          <% end %>
          <%= link_to meal_path, method: :delete, data: {confirm: 'Are you sure?'} do %>
            <i class="fas fa-trash-alt fa-l"></i>
          <% end %>
        <% end %>
      </h4>
      <p><%= @meal.price %>â‚¬</p>
    </div>

    <div class="meal-info">
      <p><%= @meal.description %></p>
      <h5>Ingredients</h5>
      <p><%= @meal.ingredients %></p>
      <h5>Portion</h5>
      <p><%= @meal.grams_per_dose %>g</p>
    </div>

<!--     <div>
      <h4>Get to know the Cook:</h4>
      <p>Name: <%= @meal.cook.first_name %>  <%= @meal.cook.last_name %></p>
      <p>Contact datails: <%= @meal.cook.email %></p>
      <p>Pick up food address: <%= @meal.cook.address %></p>
    </div> -->

    <div class="meal-footer">
      <div class="meal-time">
        <p>Pickup time: 18h / 20h</p>
      </div>
      <div class="meal-dose">
        <%= simple_form_for [@meal, @item] do |f| %>
          <div class="form-actions">
            <i class="fas fa-minus" onclick="decrease()"></i>
            <input name="item[doses]" type="number" min="1" max="10" value="4" class="val" id="item_doses">
            <i class="fas fa-plus" onclick="increase()"></i>
            <%= f.button :submit, class: "button", value:"Add to Cart" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <% ratings = [] %>
  <% @meal.reviews.each do |review| %>
    <% ratings << review.rating  %>
  <% end %>
  <% average_rating = (ratings.reduce(:+)/ratings.size.to_f).round(0)  %>

  <div class="right-section">
    <p>
      <% average_rating.times do %>
        <i class="fas fa-star star-yellow"></i>
      <% end %>
      <% (5 - average_rating).times do %>
        <i class="fas fa-star star-grey"></i>
      <% end %>
    </p>
    <p>
      <a class="button" id="show-reviews-btn">
        See the reviews for this meal
      </a>
    </p>
    <div class="meal-review" style="display: none;">
      <% @meal.reviews.each do |review| %>
        <div class="card-review">
          <div class="review-name">
            <p><%= review.user.first_name %></p>
            <p class="review-date"><%= review.created_at.strftime('%d %b %Y') %></p>
          </div>
          <div class="review-body">
            <p>"<em><%= review.content %></em>"</p>
          </div>
        </div>
      <% end %>
    </div>
  </div>

</div>

<script>
  function decrease() {
    let val = document.querySelector(".val");
    if(parseInt(val.value) > parseInt(val.min)) {
      val.value = parseInt(val.value) - 1;
    }
    return val;
  }
  function increase() {
    let val = document.querySelector(".val");
    if(parseInt(val.value) < parseInt(val.max)) {
      val.value = parseInt(val.value) + 1;
    }
    return val;
  }
</script>




